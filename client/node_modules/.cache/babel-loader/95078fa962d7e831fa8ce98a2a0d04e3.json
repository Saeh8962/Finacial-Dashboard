{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _classCallCheck = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar webIDLConversions = require(\"webidl-conversions\");\n\nvar DOMException = require(\"domexception/webidl2js-wrapper\");\n\nvar NODE_TYPE = require(\"../node-type\");\n\nvar _require = require(\"../helpers/namespaces\"),\n    HTML_NS = _require.HTML_NS;\n\nvar _require2 = require(\"../helpers/create-element\"),\n    getHTMLElementInterface = _require2.getHTMLElementInterface;\n\nvar _require3 = require(\"../helpers/shadow-dom\"),\n    shadowIncludingInclusiveDescendantsIterator = _require3.shadowIncludingInclusiveDescendantsIterator;\n\nvar _require4 = require(\"../helpers/custom-elements\"),\n    isValidCustomElementName = _require4.isValidCustomElementName,\n    tryUpgradeElement = _require4.tryUpgradeElement,\n    enqueueCEUpgradeReaction = _require4.enqueueCEUpgradeReaction;\n\nvar idlUtils = require(\"../generated/utils\");\n\nvar IDLFunction = require(\"../generated/Function.js\");\n\nvar HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\n\nvar LIFECYCLE_CALLBACKS = [\"connectedCallback\", \"disconnectedCallback\", \"adoptedCallback\", \"attributeChangedCallback\"];\n\nfunction convertToSequenceDOMString(obj) {\n  if (!obj || !obj[Symbol.iterator]) {\n    throw new TypeError(\"Invalid Sequence\");\n  }\n\n  return Array.from(obj).map(webIDLConversions.DOMString);\n} // Returns true is the passed value is a valid constructor.\n// Borrowed from: https://stackoverflow.com/a/39336206/3832710\n\n\nfunction isConstructor(value) {\n  if (typeof value !== \"function\") {\n    return false;\n  }\n\n  try {\n    var P = new Proxy(value, {\n      construct: function construct() {\n        return {};\n      }\n    }); // eslint-disable-next-line no-new\n\n    new P();\n    return true;\n  } catch (_unused) {\n    return false;\n  }\n} // https://html.spec.whatwg.org/#customelementregistry\n\n\nvar CustomElementRegistryImpl = /*#__PURE__*/function () {\n  function CustomElementRegistryImpl(globalObject) {\n    _classCallCheck(this, CustomElementRegistryImpl);\n\n    this._customElementDefinitions = [];\n    this._elementDefinitionIsRunning = false;\n    this._whenDefinedPromiseMap = Object.create(null);\n    this._globalObject = globalObject;\n  } // https://html.spec.whatwg.org/#dom-customelementregistry-define\n\n\n  _createClass(CustomElementRegistryImpl, [{\n    key: \"define\",\n    value: function define(name, constructor, options) {\n      var _globalObject = this._globalObject;\n      var ctor = constructor.objectReference;\n\n      if (!isConstructor(ctor)) {\n        throw new TypeError(\"Constructor argument is not a constructor.\");\n      }\n\n      if (!isValidCustomElementName(name)) {\n        throw DOMException.create(_globalObject, [\"Name argument is not a valid custom element name.\", \"SyntaxError\"]);\n      }\n\n      var nameAlreadyRegistered = this._customElementDefinitions.some(function (entry) {\n        return entry.name === name;\n      });\n\n      if (nameAlreadyRegistered) {\n        throw DOMException.create(_globalObject, [\"This name has already been registered in the registry.\", \"NotSupportedError\"]);\n      }\n\n      var ctorAlreadyRegistered = this._customElementDefinitions.some(function (entry) {\n        return entry.objectReference === ctor;\n      });\n\n      if (ctorAlreadyRegistered) {\n        throw DOMException.create(_globalObject, [\"This constructor has already been registered in the registry.\", \"NotSupportedError\"]);\n      }\n\n      var localName = name;\n      var extendsOption = null;\n\n      if (options !== undefined && options.extends) {\n        extendsOption = options.extends;\n      }\n\n      if (extendsOption !== null) {\n        if (isValidCustomElementName(extendsOption)) {\n          throw DOMException.create(_globalObject, [\"Option extends value can't be a valid custom element name.\", \"NotSupportedError\"]);\n        }\n\n        var extendsInterface = getHTMLElementInterface(extendsOption);\n\n        if (extendsInterface === HTMLUnknownElement) {\n          throw DOMException.create(_globalObject, [\"\".concat(extendsOption, \" is an HTMLUnknownElement.\"), \"NotSupportedError\"]);\n        }\n\n        localName = extendsOption;\n      }\n\n      if (this._elementDefinitionIsRunning) {\n        throw DOMException.create(_globalObject, [\"Invalid nested custom element definition.\", \"NotSupportedError\"]);\n      }\n\n      this._elementDefinitionIsRunning = true;\n      var disableShadow = false;\n      var observedAttributes = [];\n      var lifecycleCallbacks = {\n        connectedCallback: null,\n        disconnectedCallback: null,\n        adoptedCallback: null,\n        attributeChangedCallback: null\n      };\n      var caughtError;\n\n      try {\n        var prototype = ctor.prototype;\n\n        if (typeof prototype !== \"object\") {\n          throw new TypeError(\"Invalid constructor prototype.\");\n        }\n\n        var _iterator = _createForOfIteratorHelper(LIFECYCLE_CALLBACKS),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var callbackName = _step.value;\n            var callbackValue = prototype[callbackName];\n\n            if (callbackValue !== undefined) {\n              lifecycleCallbacks[callbackName] = IDLFunction.convert(callbackValue, {\n                context: \"The lifecycle callback \\\"\".concat(callbackName, \"\\\"\")\n              });\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n\n        if (lifecycleCallbacks.attributeChangedCallback !== null) {\n          var observedAttributesIterable = ctor.observedAttributes;\n\n          if (observedAttributesIterable !== undefined) {\n            observedAttributes = convertToSequenceDOMString(observedAttributesIterable);\n          }\n        }\n\n        var disabledFeatures = [];\n        var disabledFeaturesIterable = ctor.disabledFeatures;\n\n        if (disabledFeaturesIterable) {\n          disabledFeatures = convertToSequenceDOMString(disabledFeaturesIterable);\n        }\n\n        disableShadow = disabledFeatures.includes(\"shadow\");\n      } catch (err) {\n        caughtError = err;\n      } finally {\n        this._elementDefinitionIsRunning = false;\n      }\n\n      if (caughtError !== undefined) {\n        throw caughtError;\n      }\n\n      var definition = {\n        name: name,\n        localName: localName,\n        constructor: constructor,\n        objectReference: ctor,\n        observedAttributes: observedAttributes,\n        lifecycleCallbacks: lifecycleCallbacks,\n        disableShadow: disableShadow,\n        constructionStack: []\n      };\n\n      this._customElementDefinitions.push(definition);\n\n      var document = idlUtils.implForWrapper(this._globalObject._document);\n      var upgradeCandidates = [];\n\n      var _iterator2 = _createForOfIteratorHelper(shadowIncludingInclusiveDescendantsIterator(document)),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var candidate = _step2.value;\n\n          if (candidate._namespaceURI === HTML_NS && candidate._localName === localName && (extendsOption === null || candidate._isValue === name)) {\n            upgradeCandidates.push(candidate);\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      for (var _i = 0, _upgradeCandidates = upgradeCandidates; _i < _upgradeCandidates.length; _i++) {\n        var upgradeCandidate = _upgradeCandidates[_i];\n        enqueueCEUpgradeReaction(upgradeCandidate, definition);\n      }\n\n      if (this._whenDefinedPromiseMap[name] !== undefined) {\n        this._whenDefinedPromiseMap[name].resolve(ctor);\n\n        delete this._whenDefinedPromiseMap[name];\n      }\n    } // https://html.spec.whatwg.org/#dom-customelementregistry-get\n\n  }, {\n    key: \"get\",\n    value: function get(name) {\n      var definition = this._customElementDefinitions.find(function (entry) {\n        return entry.name === name;\n      });\n\n      return definition && definition.objectReference;\n    } // https://html.spec.whatwg.org/#dom-customelementregistry-whendefined\n\n  }, {\n    key: \"whenDefined\",\n    value: function whenDefined(name) {\n      if (!isValidCustomElementName(name)) {\n        return Promise.reject(DOMException.create(this._globalObject, [\"Name argument is not a valid custom element name.\", \"SyntaxError\"]));\n      }\n\n      var alreadyRegistered = this._customElementDefinitions.find(function (entry) {\n        return entry.name === name;\n      });\n\n      if (alreadyRegistered) {\n        return Promise.resolve(alreadyRegistered.objectReference);\n      }\n\n      if (this._whenDefinedPromiseMap[name] === undefined) {\n        var resolve;\n        var promise = new Promise(function (r) {\n          resolve = r;\n        }); // Store the pending Promise along with the extracted resolve callback to actually resolve the returned Promise,\n        // once the custom element is registered.\n\n        this._whenDefinedPromiseMap[name] = {\n          promise: promise,\n          resolve: resolve\n        };\n      }\n\n      return this._whenDefinedPromiseMap[name].promise;\n    } // https://html.spec.whatwg.org/#dom-customelementregistry-upgrade\n\n  }, {\n    key: \"upgrade\",\n    value: function upgrade(root) {\n      var _iterator3 = _createForOfIteratorHelper(shadowIncludingInclusiveDescendantsIterator(root)),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var candidate = _step3.value;\n\n          if (candidate.nodeType === NODE_TYPE.ELEMENT_NODE) {\n            tryUpgradeElement(candidate);\n          }\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }]);\n\n  return CustomElementRegistryImpl;\n}();\n\nmodule.exports = {\n  implementation: CustomElementRegistryImpl\n};","map":{"version":3,"sources":["/Users/samehrlich/Desktop/final-app/node_modules/jsdom/lib/jsdom/living/custom-elements/CustomElementRegistry-impl.js"],"names":["webIDLConversions","require","DOMException","NODE_TYPE","HTML_NS","getHTMLElementInterface","shadowIncludingInclusiveDescendantsIterator","isValidCustomElementName","tryUpgradeElement","enqueueCEUpgradeReaction","idlUtils","IDLFunction","HTMLUnknownElement","LIFECYCLE_CALLBACKS","convertToSequenceDOMString","obj","Symbol","iterator","TypeError","Array","from","map","DOMString","isConstructor","value","P","Proxy","construct","CustomElementRegistryImpl","globalObject","_customElementDefinitions","_elementDefinitionIsRunning","_whenDefinedPromiseMap","Object","create","_globalObject","name","constructor","options","ctor","objectReference","nameAlreadyRegistered","some","entry","ctorAlreadyRegistered","localName","extendsOption","undefined","extends","extendsInterface","disableShadow","observedAttributes","lifecycleCallbacks","connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback","caughtError","prototype","callbackName","callbackValue","convert","context","observedAttributesIterable","disabledFeatures","disabledFeaturesIterable","includes","err","definition","constructionStack","push","document","implForWrapper","_document","upgradeCandidates","candidate","_namespaceURI","_localName","_isValue","upgradeCandidate","resolve","find","Promise","reject","alreadyRegistered","promise","r","root","nodeType","ELEMENT_NODE","module","exports","implementation"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst webIDLConversions = require(\"webidl-conversions\");\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst NODE_TYPE = require(\"../node-type\");\n\nconst { HTML_NS } = require(\"../helpers/namespaces\");\nconst { getHTMLElementInterface } = require(\"../helpers/create-element\");\nconst { shadowIncludingInclusiveDescendantsIterator } = require(\"../helpers/shadow-dom\");\nconst { isValidCustomElementName, tryUpgradeElement, enqueueCEUpgradeReaction } = require(\"../helpers/custom-elements\");\n\nconst idlUtils = require(\"../generated/utils\");\nconst IDLFunction = require(\"../generated/Function.js\");\nconst HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\n\nconst LIFECYCLE_CALLBACKS = [\n  \"connectedCallback\",\n  \"disconnectedCallback\",\n  \"adoptedCallback\",\n  \"attributeChangedCallback\"\n];\n\nfunction convertToSequenceDOMString(obj) {\n  if (!obj || !obj[Symbol.iterator]) {\n    throw new TypeError(\"Invalid Sequence\");\n  }\n\n  return Array.from(obj).map(webIDLConversions.DOMString);\n}\n\n// Returns true is the passed value is a valid constructor.\n// Borrowed from: https://stackoverflow.com/a/39336206/3832710\nfunction isConstructor(value) {\n  if (typeof value !== \"function\") {\n    return false;\n  }\n\n  try {\n    const P = new Proxy(value, {\n      construct() {\n        return {};\n      }\n    });\n\n    // eslint-disable-next-line no-new\n    new P();\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// https://html.spec.whatwg.org/#customelementregistry\nclass CustomElementRegistryImpl {\n  constructor(globalObject) {\n    this._customElementDefinitions = [];\n    this._elementDefinitionIsRunning = false;\n    this._whenDefinedPromiseMap = Object.create(null);\n\n    this._globalObject = globalObject;\n  }\n\n  // https://html.spec.whatwg.org/#dom-customelementregistry-define\n  define(name, constructor, options) {\n    const { _globalObject } = this;\n    const ctor = constructor.objectReference;\n\n    if (!isConstructor(ctor)) {\n      throw new TypeError(\"Constructor argument is not a constructor.\");\n    }\n\n    if (!isValidCustomElementName(name)) {\n      throw DOMException.create(_globalObject, [\"Name argument is not a valid custom element name.\", \"SyntaxError\"]);\n    }\n\n    const nameAlreadyRegistered = this._customElementDefinitions.some(entry => entry.name === name);\n    if (nameAlreadyRegistered) {\n      throw DOMException.create(_globalObject, [\n        \"This name has already been registered in the registry.\",\n        \"NotSupportedError\"\n      ]);\n    }\n\n    const ctorAlreadyRegistered = this._customElementDefinitions.some(entry => entry.objectReference === ctor);\n    if (ctorAlreadyRegistered) {\n      throw DOMException.create(_globalObject, [\n        \"This constructor has already been registered in the registry.\",\n        \"NotSupportedError\"\n      ]);\n    }\n\n    let localName = name;\n\n    let extendsOption = null;\n    if (options !== undefined && options.extends) {\n      extendsOption = options.extends;\n    }\n\n    if (extendsOption !== null) {\n      if (isValidCustomElementName(extendsOption)) {\n        throw DOMException.create(_globalObject, [\n          \"Option extends value can't be a valid custom element name.\",\n          \"NotSupportedError\"\n        ]);\n      }\n\n      const extendsInterface = getHTMLElementInterface(extendsOption);\n      if (extendsInterface === HTMLUnknownElement) {\n        throw DOMException.create(_globalObject, [\n          `${extendsOption} is an HTMLUnknownElement.`,\n          \"NotSupportedError\"\n        ]);\n      }\n\n      localName = extendsOption;\n    }\n\n    if (this._elementDefinitionIsRunning) {\n      throw DOMException.create(_globalObject, [\n        \"Invalid nested custom element definition.\",\n        \"NotSupportedError\"\n      ]);\n    }\n\n    this._elementDefinitionIsRunning = true;\n\n    let disableShadow = false;\n    let observedAttributes = [];\n    const lifecycleCallbacks = {\n      connectedCallback: null,\n      disconnectedCallback: null,\n      adoptedCallback: null,\n      attributeChangedCallback: null\n    };\n\n    let caughtError;\n    try {\n      const { prototype } = ctor;\n\n      if (typeof prototype !== \"object\") {\n        throw new TypeError(\"Invalid constructor prototype.\");\n      }\n\n      for (const callbackName of LIFECYCLE_CALLBACKS) {\n        const callbackValue = prototype[callbackName];\n\n        if (callbackValue !== undefined) {\n          lifecycleCallbacks[callbackName] = IDLFunction.convert(callbackValue, {\n            context: `The lifecycle callback \"${callbackName}\"`\n          });\n        }\n      }\n\n      if (lifecycleCallbacks.attributeChangedCallback !== null) {\n        const observedAttributesIterable = ctor.observedAttributes;\n\n        if (observedAttributesIterable !== undefined) {\n          observedAttributes = convertToSequenceDOMString(observedAttributesIterable);\n        }\n      }\n\n      let disabledFeatures = [];\n      const disabledFeaturesIterable = ctor.disabledFeatures;\n      if (disabledFeaturesIterable) {\n        disabledFeatures = convertToSequenceDOMString(disabledFeaturesIterable);\n      }\n\n      disableShadow = disabledFeatures.includes(\"shadow\");\n    } catch (err) {\n      caughtError = err;\n    } finally {\n      this._elementDefinitionIsRunning = false;\n    }\n\n    if (caughtError !== undefined) {\n      throw caughtError;\n    }\n\n    const definition = {\n      name,\n      localName,\n      constructor,\n      objectReference: ctor,\n      observedAttributes,\n      lifecycleCallbacks,\n      disableShadow,\n      constructionStack: []\n    };\n\n    this._customElementDefinitions.push(definition);\n\n    const document = idlUtils.implForWrapper(this._globalObject._document);\n\n    const upgradeCandidates = [];\n    for (const candidate of shadowIncludingInclusiveDescendantsIterator(document)) {\n      if (\n        (candidate._namespaceURI === HTML_NS && candidate._localName === localName) &&\n        (extendsOption === null || candidate._isValue === name)\n      ) {\n        upgradeCandidates.push(candidate);\n      }\n    }\n\n    for (const upgradeCandidate of upgradeCandidates) {\n      enqueueCEUpgradeReaction(upgradeCandidate, definition);\n    }\n\n    if (this._whenDefinedPromiseMap[name] !== undefined) {\n      this._whenDefinedPromiseMap[name].resolve(ctor);\n      delete this._whenDefinedPromiseMap[name];\n    }\n  }\n\n  // https://html.spec.whatwg.org/#dom-customelementregistry-get\n  get(name) {\n    const definition = this._customElementDefinitions.find(entry => entry.name === name);\n    return definition && definition.objectReference;\n  }\n\n  // https://html.spec.whatwg.org/#dom-customelementregistry-whendefined\n  whenDefined(name) {\n    if (!isValidCustomElementName(name)) {\n      return Promise.reject(DOMException.create(\n        this._globalObject,\n        [\"Name argument is not a valid custom element name.\", \"SyntaxError\"]\n      ));\n    }\n\n    const alreadyRegistered = this._customElementDefinitions.find(entry => entry.name === name);\n    if (alreadyRegistered) {\n      return Promise.resolve(alreadyRegistered.objectReference);\n    }\n\n    if (this._whenDefinedPromiseMap[name] === undefined) {\n      let resolve;\n      const promise = new Promise(r => {\n        resolve = r;\n      });\n\n      // Store the pending Promise along with the extracted resolve callback to actually resolve the returned Promise,\n      // once the custom element is registered.\n      this._whenDefinedPromiseMap[name] = {\n        promise,\n        resolve\n      };\n    }\n\n    return this._whenDefinedPromiseMap[name].promise;\n  }\n\n  // https://html.spec.whatwg.org/#dom-customelementregistry-upgrade\n  upgrade(root) {\n    for (const candidate of shadowIncludingInclusiveDescendantsIterator(root)) {\n      if (candidate.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        tryUpgradeElement(candidate);\n      }\n    }\n  }\n}\n\nmodule.exports = {\n  implementation: CustomElementRegistryImpl\n};\n"]},"metadata":{},"sourceType":"script"}
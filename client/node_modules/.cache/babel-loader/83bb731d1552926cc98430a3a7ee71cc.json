{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _createForOfIteratorHelper = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _classCallCheck = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/samehrlich/Desktop/final-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar parse5 = require(\"parse5\");\n\nvar _require = require(\"../../living/helpers/create-element\"),\n    _createElement = _require.createElement;\n\nvar _require2 = require(\"../../living/helpers/namespaces\"),\n    HTML_NS = _require2.HTML_NS;\n\nvar DocumentType = require(\"../../living/generated/DocumentType\");\n\nvar DocumentFragment = require(\"../../living/generated/DocumentFragment\");\n\nvar Text = require(\"../../living/generated/Text\");\n\nvar Comment = require(\"../../living/generated/Comment\");\n\nvar attributes = require(\"../../living/attributes\");\n\nvar nodeTypes = require(\"../../living/node-type\");\n\nvar serializationAdapter = require(\"../../living/domparsing/parse5-adapter-serialization\");\n\nvar _require3 = require(\"../../living/helpers/custom-elements\"),\n    customElementReactionsStack = _require3.customElementReactionsStack,\n    invokeCEReactions = _require3.invokeCEReactions,\n    lookupCEDefinition = _require3.lookupCEDefinition; // Horrible monkey-patch to implement https://github.com/inikulin/parse5/issues/237 and\n// https://github.com/inikulin/parse5/issues/285.\n\n\nvar OpenElementStack = require(\"parse5/lib/parser/open-element-stack\");\n\nvar openElementStackOriginalPush = OpenElementStack.prototype.push;\n\nOpenElementStack.prototype.push = function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  openElementStackOriginalPush.apply(this, args);\n  this.treeAdapter._currentElement = this.current;\n  var after = this.items[this.stackTop];\n\n  if (after._pushedOnStackOfOpenElements) {\n    after._pushedOnStackOfOpenElements();\n  }\n};\n\nvar openElementStackOriginalPop = OpenElementStack.prototype.pop;\n\nOpenElementStack.prototype.pop = function () {\n  var before = this.items[this.stackTop];\n\n  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    args[_key2] = arguments[_key2];\n  }\n\n  openElementStackOriginalPop.apply(this, args);\n  this.treeAdapter._currentElement = this.current;\n\n  if (before._poppedOffStackOfOpenElements) {\n    before._poppedOffStackOfOpenElements();\n  }\n};\n\nvar JSDOMParse5Adapter = /*#__PURE__*/function () {\n  function JSDOMParse5Adapter(documentImpl) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, JSDOMParse5Adapter);\n\n    this._documentImpl = documentImpl;\n    this._globalObject = documentImpl._globalObject;\n    this._fragment = options.fragment || false; // Since the createElement hook doesn't provide the parent element, we keep track of this using _currentElement:\n    // https://github.com/inikulin/parse5/issues/285. See above horrible monkey-patch for how this is maintained.\n\n    this._currentElement = undefined;\n  }\n\n  _createClass(JSDOMParse5Adapter, [{\n    key: \"_ownerDocument\",\n    value: function _ownerDocument() {\n      var _currentElement = this._currentElement; // The _currentElement is undefined when parsing elements at the root of the document.\n\n      if (_currentElement) {\n        return _currentElement.localName === \"template\" && _currentElement.namespaceURI === HTML_NS ? _currentElement.content._ownerDocument : _currentElement._ownerDocument;\n      }\n\n      return this._documentImpl;\n    }\n  }, {\n    key: \"createDocument\",\n    value: function createDocument() {\n      // parse5's model assumes that parse(html) will call into here to create the new Document, then return it. However,\n      // jsdom's model assumes we can create a Window (and through that create an empty Document), do some other setup\n      // stuff, and then parse, stuffing nodes into that Document as we go. So to adapt between these two models, we just\n      // return the already-created Document when asked by parse5 to \"create\" a Document.\n      return this._documentImpl;\n    }\n  }, {\n    key: \"createDocumentFragment\",\n    value: function createDocumentFragment() {\n      var ownerDocument = this._ownerDocument();\n\n      return DocumentFragment.createImpl(this._globalObject, [], {\n        ownerDocument: ownerDocument\n      });\n    } // https://html.spec.whatwg.org/#create-an-element-for-the-token\n\n  }, {\n    key: \"createElement\",\n    value: function createElement(localName, namespace, attrs) {\n      var ownerDocument = this._ownerDocument();\n\n      var isAttribute = attrs.find(function (attr) {\n        return attr.name === \"is\";\n      });\n      var isValue = isAttribute ? isAttribute.value : null;\n      var definition = lookupCEDefinition(ownerDocument, namespace, localName);\n      var willExecuteScript = false;\n\n      if (definition !== null && !this._fragment) {\n        willExecuteScript = true;\n      }\n\n      if (willExecuteScript) {\n        ownerDocument._throwOnDynamicMarkupInsertionCounter++;\n        customElementReactionsStack.push([]);\n      }\n\n      var element = _createElement(ownerDocument, localName, namespace, null, isValue, willExecuteScript);\n\n      this.adoptAttributes(element, attrs);\n\n      if (willExecuteScript) {\n        var queue = customElementReactionsStack.pop();\n        invokeCEReactions(queue);\n        ownerDocument._throwOnDynamicMarkupInsertionCounter--;\n      }\n\n      if (\"_parserInserted\" in element) {\n        element._parserInserted = true;\n      }\n\n      return element;\n    }\n  }, {\n    key: \"createCommentNode\",\n    value: function createCommentNode(data) {\n      var ownerDocument = this._ownerDocument();\n\n      return Comment.createImpl(this._globalObject, [], {\n        data: data,\n        ownerDocument: ownerDocument\n      });\n    }\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(parentNode, newNode) {\n      parentNode._append(newNode);\n    }\n  }, {\n    key: \"insertBefore\",\n    value: function insertBefore(parentNode, newNode, referenceNode) {\n      parentNode._insert(newNode, referenceNode);\n    }\n  }, {\n    key: \"setTemplateContent\",\n    value: function setTemplateContent(templateElement, contentFragment) {\n      // This code makes the glue between jsdom and parse5 HTMLTemplateElement parsing:\n      //\n      // * jsdom during the construction of the HTMLTemplateElement (for example when create via\n      //   `document.createElement(\"template\")`), creates a DocumentFragment and set it into _templateContents.\n      // * parse5 when parsing a <template> tag creates an HTMLTemplateElement (`createElement` adapter hook) and also\n      //   create a DocumentFragment (`createDocumentFragment` adapter hook).\n      //\n      // At this point we now have to replace the one created in jsdom with one created by parse5.\n      var _templateElement$_tem = templateElement._templateContents,\n          _ownerDocument = _templateElement$_tem._ownerDocument,\n          _host = _templateElement$_tem._host;\n      contentFragment._ownerDocument = _ownerDocument;\n      contentFragment._host = _host;\n      templateElement._templateContents = contentFragment;\n    }\n  }, {\n    key: \"setDocumentType\",\n    value: function setDocumentType(document, name, publicId, systemId) {\n      var ownerDocument = this._ownerDocument();\n\n      var documentType = DocumentType.createImpl(this._globalObject, [], {\n        name: name,\n        publicId: publicId,\n        systemId: systemId,\n        ownerDocument: ownerDocument\n      });\n\n      document._append(documentType);\n    }\n  }, {\n    key: \"setDocumentMode\",\n    value: function setDocumentMode(document, mode) {\n      // TODO: the rest of jsdom ignores this\n      document._mode = mode;\n    }\n  }, {\n    key: \"detachNode\",\n    value: function detachNode(node) {\n      node.remove();\n    }\n  }, {\n    key: \"insertText\",\n    value: function insertText(parentNode, text) {\n      var lastChild = parentNode.lastChild;\n\n      if (lastChild && lastChild.nodeType === nodeTypes.TEXT_NODE) {\n        lastChild.data += text;\n      } else {\n        var ownerDocument = this._ownerDocument();\n\n        var textNode = Text.createImpl(this._globalObject, [], {\n          data: text,\n          ownerDocument: ownerDocument\n        });\n\n        parentNode._append(textNode);\n      }\n    }\n  }, {\n    key: \"insertTextBefore\",\n    value: function insertTextBefore(parentNode, text, referenceNode) {\n      var previousSibling = referenceNode.previousSibling;\n\n      if (previousSibling && previousSibling.nodeType === nodeTypes.TEXT_NODE) {\n        previousSibling.data += text;\n      } else {\n        var ownerDocument = this._ownerDocument();\n\n        var textNode = Text.createImpl(this._globalObject, [], {\n          data: text,\n          ownerDocument: ownerDocument\n        });\n\n        parentNode._append(textNode, referenceNode);\n      }\n    }\n  }, {\n    key: \"adoptAttributes\",\n    value: function adoptAttributes(element, attrs) {\n      var _iterator = _createForOfIteratorHelper(attrs),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var attr = _step.value;\n          var prefix = attr.prefix === \"\" ? null : attr.prefix;\n          attributes.setAttributeValue(element, attr.name, attr.value, prefix, attr.namespace);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }]);\n\n  return JSDOMParse5Adapter;\n}(); // Assign shared adapters with serializer.\n\n\nObject.assign(JSDOMParse5Adapter.prototype, serializationAdapter);\n\nfunction parseFragment(markup, contextElement) {\n  var ownerDocument = contextElement.localName === \"template\" && contextElement.namespaceURI === HTML_NS ? contextElement.content._ownerDocument : contextElement._ownerDocument;\n\n  var config = _objectSpread(_objectSpread({}, ownerDocument._parseOptions), {}, {\n    treeAdapter: new JSDOMParse5Adapter(ownerDocument, {\n      fragment: true\n    })\n  });\n\n  return parse5.parseFragment(contextElement, markup, config);\n}\n\nfunction parseIntoDocument(markup, ownerDocument) {\n  var config = _objectSpread(_objectSpread({}, ownerDocument._parseOptions), {}, {\n    treeAdapter: new JSDOMParse5Adapter(ownerDocument)\n  });\n\n  return parse5.parse(markup, config);\n}\n\nmodule.exports = {\n  parseFragment: parseFragment,\n  parseIntoDocument: parseIntoDocument\n};","map":{"version":3,"sources":["/Users/samehrlich/Desktop/final-app/node_modules/jsdom/lib/jsdom/browser/parser/html.js"],"names":["parse5","require","createElement","HTML_NS","DocumentType","DocumentFragment","Text","Comment","attributes","nodeTypes","serializationAdapter","customElementReactionsStack","invokeCEReactions","lookupCEDefinition","OpenElementStack","openElementStackOriginalPush","prototype","push","args","apply","treeAdapter","_currentElement","current","after","items","stackTop","_pushedOnStackOfOpenElements","openElementStackOriginalPop","pop","before","_poppedOffStackOfOpenElements","JSDOMParse5Adapter","documentImpl","options","_documentImpl","_globalObject","_fragment","fragment","undefined","localName","namespaceURI","content","_ownerDocument","ownerDocument","createImpl","namespace","attrs","isAttribute","find","attr","name","isValue","value","definition","willExecuteScript","_throwOnDynamicMarkupInsertionCounter","element","adoptAttributes","queue","_parserInserted","data","parentNode","newNode","_append","referenceNode","_insert","templateElement","contentFragment","_templateContents","_host","document","publicId","systemId","documentType","mode","_mode","node","remove","text","lastChild","nodeType","TEXT_NODE","textNode","previousSibling","prefix","setAttributeValue","Object","assign","parseFragment","markup","contextElement","config","_parseOptions","parseIntoDocument","parse","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst parse5 = require(\"parse5\");\n\nconst { createElement } = require(\"../../living/helpers/create-element\");\nconst { HTML_NS } = require(\"../../living/helpers/namespaces\");\n\nconst DocumentType = require(\"../../living/generated/DocumentType\");\nconst DocumentFragment = require(\"../../living/generated/DocumentFragment\");\nconst Text = require(\"../../living/generated/Text\");\nconst Comment = require(\"../../living/generated/Comment\");\n\nconst attributes = require(\"../../living/attributes\");\nconst nodeTypes = require(\"../../living/node-type\");\n\nconst serializationAdapter = require(\"../../living/domparsing/parse5-adapter-serialization\");\nconst {\n  customElementReactionsStack, invokeCEReactions, lookupCEDefinition\n} = require(\"../../living/helpers/custom-elements\");\n\n// Horrible monkey-patch to implement https://github.com/inikulin/parse5/issues/237 and\n// https://github.com/inikulin/parse5/issues/285.\nconst OpenElementStack = require(\"parse5/lib/parser/open-element-stack\");\n\nconst openElementStackOriginalPush = OpenElementStack.prototype.push;\nOpenElementStack.prototype.push = function (...args) {\n  openElementStackOriginalPush.apply(this, args);\n  this.treeAdapter._currentElement = this.current;\n\n  const after = this.items[this.stackTop];\n  if (after._pushedOnStackOfOpenElements) {\n    after._pushedOnStackOfOpenElements();\n  }\n};\n\nconst openElementStackOriginalPop = OpenElementStack.prototype.pop;\nOpenElementStack.prototype.pop = function (...args) {\n  const before = this.items[this.stackTop];\n\n  openElementStackOriginalPop.apply(this, args);\n  this.treeAdapter._currentElement = this.current;\n\n  if (before._poppedOffStackOfOpenElements) {\n    before._poppedOffStackOfOpenElements();\n  }\n};\n\nclass JSDOMParse5Adapter {\n  constructor(documentImpl, options = {}) {\n    this._documentImpl = documentImpl;\n    this._globalObject = documentImpl._globalObject;\n    this._fragment = options.fragment || false;\n\n    // Since the createElement hook doesn't provide the parent element, we keep track of this using _currentElement:\n    // https://github.com/inikulin/parse5/issues/285. See above horrible monkey-patch for how this is maintained.\n    this._currentElement = undefined;\n  }\n\n  _ownerDocument() {\n    const { _currentElement } = this;\n\n    // The _currentElement is undefined when parsing elements at the root of the document.\n    if (_currentElement) {\n      return _currentElement.localName === \"template\" && _currentElement.namespaceURI === HTML_NS ?\n        _currentElement.content._ownerDocument :\n        _currentElement._ownerDocument;\n    }\n\n    return this._documentImpl;\n  }\n\n  createDocument() {\n    // parse5's model assumes that parse(html) will call into here to create the new Document, then return it. However,\n    // jsdom's model assumes we can create a Window (and through that create an empty Document), do some other setup\n    // stuff, and then parse, stuffing nodes into that Document as we go. So to adapt between these two models, we just\n    // return the already-created Document when asked by parse5 to \"create\" a Document.\n    return this._documentImpl;\n  }\n\n  createDocumentFragment() {\n    const ownerDocument = this._ownerDocument();\n    return DocumentFragment.createImpl(this._globalObject, [], { ownerDocument });\n  }\n\n  // https://html.spec.whatwg.org/#create-an-element-for-the-token\n  createElement(localName, namespace, attrs) {\n    const ownerDocument = this._ownerDocument();\n\n    const isAttribute = attrs.find(attr => attr.name === \"is\");\n    const isValue = isAttribute ? isAttribute.value : null;\n\n    const definition = lookupCEDefinition(ownerDocument, namespace, localName);\n\n    let willExecuteScript = false;\n    if (definition !== null && !this._fragment) {\n      willExecuteScript = true;\n    }\n\n    if (willExecuteScript) {\n      ownerDocument._throwOnDynamicMarkupInsertionCounter++;\n      customElementReactionsStack.push([]);\n    }\n\n    const element = createElement(ownerDocument, localName, namespace, null, isValue, willExecuteScript);\n    this.adoptAttributes(element, attrs);\n\n    if (willExecuteScript) {\n      const queue = customElementReactionsStack.pop();\n      invokeCEReactions(queue);\n      ownerDocument._throwOnDynamicMarkupInsertionCounter--;\n    }\n\n    if (\"_parserInserted\" in element) {\n      element._parserInserted = true;\n    }\n\n    return element;\n  }\n\n  createCommentNode(data) {\n    const ownerDocument = this._ownerDocument();\n    return Comment.createImpl(this._globalObject, [], { data, ownerDocument });\n  }\n\n  appendChild(parentNode, newNode) {\n    parentNode._append(newNode);\n  }\n\n  insertBefore(parentNode, newNode, referenceNode) {\n    parentNode._insert(newNode, referenceNode);\n  }\n\n  setTemplateContent(templateElement, contentFragment) {\n    // This code makes the glue between jsdom and parse5 HTMLTemplateElement parsing:\n    //\n    // * jsdom during the construction of the HTMLTemplateElement (for example when create via\n    //   `document.createElement(\"template\")`), creates a DocumentFragment and set it into _templateContents.\n    // * parse5 when parsing a <template> tag creates an HTMLTemplateElement (`createElement` adapter hook) and also\n    //   create a DocumentFragment (`createDocumentFragment` adapter hook).\n    //\n    // At this point we now have to replace the one created in jsdom with one created by parse5.\n    const { _ownerDocument, _host } = templateElement._templateContents;\n    contentFragment._ownerDocument = _ownerDocument;\n    contentFragment._host = _host;\n\n    templateElement._templateContents = contentFragment;\n  }\n\n  setDocumentType(document, name, publicId, systemId) {\n    const ownerDocument = this._ownerDocument();\n    const documentType = DocumentType.createImpl(this._globalObject, [], { name, publicId, systemId, ownerDocument });\n\n    document._append(documentType);\n  }\n\n  setDocumentMode(document, mode) {\n    // TODO: the rest of jsdom ignores this\n    document._mode = mode;\n  }\n\n  detachNode(node) {\n    node.remove();\n  }\n\n  insertText(parentNode, text) {\n    const { lastChild } = parentNode;\n    if (lastChild && lastChild.nodeType === nodeTypes.TEXT_NODE) {\n      lastChild.data += text;\n    } else {\n      const ownerDocument = this._ownerDocument();\n      const textNode = Text.createImpl(this._globalObject, [], { data: text, ownerDocument });\n      parentNode._append(textNode);\n    }\n  }\n\n  insertTextBefore(parentNode, text, referenceNode) {\n    const { previousSibling } = referenceNode;\n    if (previousSibling && previousSibling.nodeType === nodeTypes.TEXT_NODE) {\n      previousSibling.data += text;\n    } else {\n      const ownerDocument = this._ownerDocument();\n      const textNode = Text.createImpl(this._globalObject, [], { data: text, ownerDocument });\n      parentNode._append(textNode, referenceNode);\n    }\n  }\n\n  adoptAttributes(element, attrs) {\n    for (const attr of attrs) {\n      const prefix = attr.prefix === \"\" ? null : attr.prefix;\n      attributes.setAttributeValue(element, attr.name, attr.value, prefix, attr.namespace);\n    }\n  }\n}\n\n// Assign shared adapters with serializer.\nObject.assign(JSDOMParse5Adapter.prototype, serializationAdapter);\n\nfunction parseFragment(markup, contextElement) {\n  const ownerDocument = contextElement.localName === \"template\" && contextElement.namespaceURI === HTML_NS ?\n    contextElement.content._ownerDocument :\n    contextElement._ownerDocument;\n\n  const config = {\n    ...ownerDocument._parseOptions,\n    treeAdapter: new JSDOMParse5Adapter(ownerDocument, { fragment: true })\n  };\n\n  return parse5.parseFragment(contextElement, markup, config);\n}\n\nfunction parseIntoDocument(markup, ownerDocument) {\n  const config = {\n    ...ownerDocument._parseOptions,\n    treeAdapter: new JSDOMParse5Adapter(ownerDocument)\n  };\n\n  return parse5.parse(markup, config);\n}\n\nmodule.exports = {\n  parseFragment,\n  parseIntoDocument\n};\n"]},"metadata":{},"sourceType":"script"}